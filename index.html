<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å€‹äººæ¯æ—¥æ‰“å¡</title>
<style>
body {
  font-family: system-ui;
  background: url("https://raw.githubusercontent.com/ä½ çš„å¸³è™Ÿ/ä½ çš„repo/main/background.jpg") no-repeat center center fixed;
  background-size: cover;
  color: #ffffff;
  text-align: center;
  padding: 20px;
  margin: 0;
  position: relative;
  transition: background 0.3s;
}
body::before {
  content: "";
  position: fixed;
  top:0; left:0;
  width:100%; height:100%;
  background: rgba(0,0,0,0.5);
  z-index:-1;
}
button {
  padding: 8px 14px;
  border-radius: 999px;
  border: none;
  margin: 6px;
  font-size: 1rem;
  background: #22c55e;
  color: #022c22;
  cursor: pointer;
}
#history {
  margin-top: 20px;
  text-align: left;
  max-width: 400px;
  margin-left: auto;
  margin-right: auto;
}
.history-item {
  padding: 4px 8px;
  background: rgba(0,0,0,0.3);
  margin-bottom: 4px;
  border-radius: 6px;
}
#bgControl {
  margin-top: 12px;
}
#bgControl input {
  padding: 6px;
  width: 60%;
  border-radius: 6px;
  border: none;
  margin-right: 6px;
}
#bgControl button {
  background: #f59e0b;
  color: #1e293b;
}
</style>
</head>
<body>

<h1>ğŸ“… è”¡æ˜å‹³æ¯æ—¥æ‰“å¡</h1>

<button id="checkinBtn">ä»Šå¤©æ‰“å¡ âœ…</button>
<button id="exportBtn">åŒ¯å‡º CSV</button>

<p id="streak">ğŸ”¥ é€£çºŒæ‰“å¡ 0 å¤©</p>

<div id="history"><strong>ğŸ“– æ‰“å¡ç´€éŒ„ï¼š</strong></div>

<!-- èƒŒæ™¯æ§åˆ¶å€ -->
<div id="bgControl">
  <p>æ›´æ›èƒŒæ™¯åœ–ç‰‡ï¼š</p>
  <input type="text" id="bgUrl" placeholder="è²¼ä¸Šåœ–ç‰‡ç¶²å€">
  <button id="changeBg">å¥—ç”¨èƒŒæ™¯</button>
</div>

<script>
const KEY = "checkin_history";
const FIXED_NAME = "è”¡æ˜å‹³";

// è®€å–è³‡æ–™
function load() { return JSON.parse(localStorage.getItem(KEY)) || []; }
function save(data) { localStorage.setItem(KEY, JSON.stringify(data)); }
function today() { return new Date().toISOString().split("T")[0]; }

// æ¸²æŸ“æ–‡å­—æ­·å²ç´€éŒ„ï¼ˆåªé¡¯ç¤ºæ—¥æœŸï¼‰
function renderHistory() {
  const data = load();
  const historyEl = document.getElementById("history");
  historyEl.innerHTML = "<strong>ğŸ“– æ‰“å¡ç´€éŒ„ï¼š</strong>";
  data.forEach(item => {
    const div = document.createElement("div");
    div.className = "history-item";
    div.textContent = `ğŸ‘¤ ${FIXED_NAME} âœ… ${item.date}`;
    historyEl.appendChild(div);
  });
}

// è¨ˆç®—é€£çºŒæ‰“å¡å¤©æ•¸
function calcStreak(data) {
  let streak = 0;
  let d = new Date();
  while (data.some(e => e.date === d.toISOString().split("T")[0])) {
    streak++;
    d.setDate(d.getDate()-1);
  }
  return streak;
}

// æ‰“å¡æŒ‰éˆ•äº‹ä»¶
document.getElementById("checkinBtn").onclick = () => {
  const data = load();
  const t = today();
  if (data.some(e => e.date === t)) { alert("ä»Šå¤©å·²æ‰“éå¡ âœ…"); return; }

  data.push({date: t});
  save(data);
  renderHistory();
  document.getElementById("streak").textContent = `ğŸ”¥ ${FIXED_NAME} é€£çºŒæ‰“å¡ ${calcStreak(data)} å¤©`;
};

// åŒ¯å‡º CSVï¼ˆåªè¼¸å‡ºæ—¥æœŸï¼‰
document.getElementById("exportBtn").onclick = () => {
  const data = load();
  if (data.length === 0) { alert("æ²’æœ‰æ‰“å¡è³‡æ–™å¯ä»¥åŒ¯å‡º"); return; }

  let csv = "å§“å,æ—¥æœŸ\n";
  data.forEach(e => {
    csv += `${FIXED_NAME},${e.date}\n`;
  });

  const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = `${FIXED_NAME}_æ‰“å¡ç´€éŒ„.csv`;
  link.click();
};

// æ›´æ›èƒŒæ™¯æŒ‰éˆ•äº‹ä»¶
document.getElementById("changeBg").onclick = () => {
  const url = document.getElementById("bgUrl").value;
  if(url) document.body.style.backgroundImage = `url("${url}")`;
};

// åˆå§‹æ¸²æŸ“
renderHistory();
document.getElementById("streak").textContent = `ğŸ”¥ ${FIXED_NAME} é€£çºŒæ‰“å¡ ${calcStreak(load())} å¤©`;

</script>

</body>
</html>
