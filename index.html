<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å€‹äººæ¯æ—¥æ‰“å¡</title>
<style>
body {
  font-family: system-ui;
  background: url("https://raw.githubusercontent.com/ä½ çš„å¸³è™Ÿ/ä½ çš„repo/main/background.jpg") no-repeat center center fixed;
  background-size: cover;
  color: #ffffff;
  text-align: center;
  padding: 20px;
  margin: 0;
  position: relative;
}
body::before {
  content: "";
  position: fixed;
  top:0; left:0;
  width:100%; height:100%;
  background: rgba(0,0,0,0.5);
  z-index:-1;
}
button {
  padding: 8px 14px;
  border-radius: 999px;
  border: none;
  margin: 6px;
  font-size: 1rem;
  background: #22c55e;
  color: #022c22;
  cursor: pointer;
}
.grid {
  display: grid;
  grid-template-columns: repeat(7, 20px);
  gap: 5px;
  justify-content: center;
  margin-top: 20px;
}
.day {
  width: 20px;
  height: 20px;
  border-radius: 3px;
  background: #1e293b;
}
.lvl1 { background: #86efac; }
.lvl2 { background: #4ade80; }
.lvl3 { background: #22c55e; }
.lvl4 { background: #16a34a; }
</style>
</head>
<body>

<h1>ğŸ“… è”¡æ˜å‹³æ¯æ—¥æ‰“å¡</h1>

<button id="checkinBtn">ä»Šå¤©æ‰“å¡ âœ…</button>
<button id="exportBtn">åŒ¯å‡º CSV</button>

<p id="streak">ğŸ”¥ é€£çºŒæ‰“å¡ 0 å¤©</p>

<div class="grid" id="grid"></div>

<script>
const KEY = "checkin_history";
const DAYS = 112; // é¡¯ç¤ºæ ¼å­å¤©æ•¸
const FIXED_NAME = "è”¡æ˜å‹³";

const grid = document.getElementById("grid");
const streakEl = document.getElementById("streak");

function load() { return JSON.parse(localStorage.getItem(KEY)) || []; }
function save(data) { localStorage.setItem(KEY, JSON.stringify(data)); }
function today() { return new Date().toISOString().split("T")[0]; }

// æ‰“å¡æŒ‰éˆ•
document.getElementById("checkinBtn").onclick = () => {
  const data = load();
  const t = today();
  if (data.includes(t)) { alert("ä»Šå¤©å·²æ‰“éå¡ âœ…"); return; }
  data.push(t);
  save(data);
  render();
};

// è¨ˆç®—é€£çºŒæ‰“å¡
function calcStreak(data) {
  let streak = 0;
  let d = new Date();
  while (data.includes(d.toISOString().split("T")[0])) {
    streak++;
    d.setDate(d.getDate() - 1);
  }
  return streak;
}

// æ ¼å­é¡è‰²ï¼ˆé€£çºŒå¤©æ•¸åŠ æ·±ï¼‰
function getLevel(dateStr, data) {
  let count = 0;
  const d = new Date(dateStr);
  for (let i = 0; i < 4; i++) {
    const key = new Date(d);
    key.setDate(d.getDate() - i);
    const keyStr = key.toISOString().split("T")[0];
    if (data.includes(keyStr)) count++;
  }
  return Math.min(count, 4);
}

// æ¸²æŸ“æ ¼å­ï¼ˆç„¡è£œæ‰“å¡ï¼‰
function render() {
  const data = load();
  grid.innerHTML = "";

  for (let i = DAYS-1; i >=0; i--) {
    const d = new Date();
    d.setDate(d.getDate()-i);
    const dateStr = d.toISOString().split("T")[0];
    const div = document.createElement("div");
    div.className = `day lvl${getLevel(dateStr, data)}`;
    div.title = data.includes(dateStr) ? `âœ… ${dateStr}` : `âŒ ${dateStr}`;
    grid.appendChild(div);
  }

  streakEl.textContent = `ğŸ”¥ ${FIXED_NAME} é€£çºŒæ‰“å¡ ${calcStreak(data)} å¤©`;
}

render();

// åŒ¯å‡º CSV
document.getElementById("exportBtn").onclick = () => {
  const data = load();
  if (data.length===0) { alert("æ²’æœ‰æ‰“å¡è³‡æ–™å¯ä»¥åŒ¯å‡º"); return; }

  let csv = "å§“å,æ—¥æœŸ,æ˜¯å¦æ‰“å¡\n";
  data.forEach(e => {
    csv += `${FIXED_NAME},${e},âœ…\n`;
  });

  const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = `${FIXED_NAME}_æ‰“å¡ç´€éŒ„.csv`;
  link.click();
};
</script>

</body>
</html>
